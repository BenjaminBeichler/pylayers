

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Outdoor Coverage Knife-Edge Model &mdash; PyLayers</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Slabs and Materials" href="../2-AP/SlabsMaterials.html" />
    <link rel="prev" title="Geographical Information and the Earth Zone class : Ezone" href="Ezone.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Python
          

          
            
            <img src="../../_static/pylayers.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../TOC.html">1&nbsp;&nbsp;&nbsp;Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../TOC.html#basic-usage">2&nbsp;&nbsp;&nbsp;Basic Usage</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../TOC.html#environment-description">3&nbsp;&nbsp;&nbsp;Environment Description</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Layout.html">Description of the propagation environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="Multisubsegments.html">Modifying the segment nature</a></li>
<li class="toctree-l3"><a class="reference internal" href="Ezone.html">Geographical Information and the Earth Zone class : <code class="docutils literal notranslate"><span class="pre">Ezone</span></code></a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Outdoor Coverage Knife-Edge Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../TOC.html#materials-and-slabs">4&nbsp;&nbsp;&nbsp;Materials and Slabs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../TOC.html#description-of-antennas">5&nbsp;&nbsp;&nbsp;Description of Antennas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../TOC.html#coverage-simulation">6&nbsp;&nbsp;&nbsp;Coverage Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../TOC.html#ray-tracing-simulation">7&nbsp;&nbsp;&nbsp;Ray Tracing Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../TOC.html#handling-agent-mobility">8&nbsp;&nbsp;&nbsp;Handling Agent Mobility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../TOC.html#other-simulation-examples">9&nbsp;&nbsp;&nbsp;Other Simulation Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../TOC.html#localization-algorithms">10&nbsp;&nbsp;&nbsp;Localization Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../TOC.html#measurements-tools">11&nbsp;&nbsp;&nbsp;Measurements Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../TOC.html#pylayers-tools">12&nbsp;&nbsp;&nbsp;PyLayers Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_exLayout1.html">Loading an outdoor layout from its address</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_antenna.html">Antenna Pattern for an H plane sectoral antenna &#64; 32GHz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_exLayout2.html">Building graphs of a Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_coverage.html">Indoor Radio Coverage with Motley Keenan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_layout.html">8 Random Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_issue314.html">Exemple of issue 314</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_exAbsGas.html">Attenuation due to atmospheric gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_exDLink.html">Evaluation of a radio link DLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_w1.html">Indoor Radio Coverage FP7 WHERE1 M1 setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_exLuebbers.html">UWB Ray tracing simulation  in outdoor scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_diffraction_polar.html">Diffraction coefficient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_examples/plot_diffraction.html">Diffraction coefficient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html">1&nbsp;&nbsp;&nbsp;pylayers.util.project Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.gis.layout">2&nbsp;&nbsp;&nbsp;pylayers.gis.layout Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.gis.selectl">3&nbsp;&nbsp;&nbsp;pylayers.gis.selectl Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.gis.srtm">4&nbsp;&nbsp;&nbsp;pylayers.gis.srtm Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.gis.osmparser">5&nbsp;&nbsp;&nbsp;pylayers.gis.osmparser Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.gis.ezone">6&nbsp;&nbsp;&nbsp;pylayers.gis.ezone Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.antenna">7&nbsp;&nbsp;&nbsp;pylayers.antprop.antenna Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.aarray">8&nbsp;&nbsp;&nbsp;pylayers.antprop.aarray Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.spharm">9&nbsp;&nbsp;&nbsp;pylayers.antprop.spharm Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.antssh">10&nbsp;&nbsp;&nbsp;pylayers.antprop.antssh Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.antvsh">11&nbsp;&nbsp;&nbsp;pylayers.antprop.antvsh Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.slab">12&nbsp;&nbsp;&nbsp;pylayers.antprop.slab Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.signature">13&nbsp;&nbsp;&nbsp;pylayers.antprop.signature Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.interactions">14&nbsp;&nbsp;&nbsp;pylayers.antprop.interactions Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.diffraction">15&nbsp;&nbsp;&nbsp;pylayers.antprop.diffraction Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.diffRT">16&nbsp;&nbsp;&nbsp;pylayers.antprop.diffRT Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.rays">17&nbsp;&nbsp;&nbsp;pylayers.antprop.rays Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.loss">18&nbsp;&nbsp;&nbsp;pylayers.antprop.loss Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.channel">19&nbsp;&nbsp;&nbsp;pylayers.antprop.channel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#id39">20&nbsp;&nbsp;&nbsp;pylayers.antprop.loss Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.coverage">21&nbsp;&nbsp;&nbsp;pylayers.antprop.coverage Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.antprop.coeffModel">22&nbsp;&nbsp;&nbsp;pylayers.antprop.coeffModel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.simul.link">23&nbsp;&nbsp;&nbsp;pylayers.simul.link Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.simul.exploit">24&nbsp;&nbsp;&nbsp;pylayers.simul.exploit Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.simul.exploit_simulnet">25&nbsp;&nbsp;&nbsp;pylayers.simul.exploit_simulnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.simul.simulnet">26&nbsp;&nbsp;&nbsp;pylayers.simul.simulnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.simul.simultraj">27&nbsp;&nbsp;&nbsp;pylayers.simul.simultraj Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.exploit.simnet">28&nbsp;&nbsp;&nbsp;pylayers.exploit.simnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.measures.mesuwb">29&nbsp;&nbsp;&nbsp;pylayers.measures.mesuwb Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.measures.mesmimo">30&nbsp;&nbsp;&nbsp;pylayers.measures.mesmimo Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.measures.cormoran">31&nbsp;&nbsp;&nbsp;pylayers.measures.cormoran Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.measures.vna.E5072A">32&nbsp;&nbsp;&nbsp;pylayers.measures.vna.E5072A Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.measures.parker.smparker">33&nbsp;&nbsp;&nbsp;pylayers.measures.parker.smparker Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.signal.bsignal">34&nbsp;&nbsp;&nbsp;pylayers.signal.bsignal Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.signal.standard">35&nbsp;&nbsp;&nbsp;pylayers.signal.standard Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.signal.device">36&nbsp;&nbsp;&nbsp;pylayers.signal.device Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.signal.DF">37&nbsp;&nbsp;&nbsp;pylayers.signal.DF Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.signal.waveform">38&nbsp;&nbsp;&nbsp;pylayers.signal.waveform Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.mobility.agent">39&nbsp;&nbsp;&nbsp;pylayers.mobility.agent Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#module-pylayers.mobility.ban.body">40&nbsp;&nbsp;&nbsp;pylayers.mobility.ban.body Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/references.html#id138">41&nbsp;&nbsp;&nbsp;pylayers.measures.cormoran Module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User Manual</a> &raquo;</li>
        
          <li><a href="../TOC.html">1&nbsp;&nbsp;&nbsp;Overview</a> &raquo;</li>
        
      <li>Outdoor Coverage Knife-Edge Model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebook/1-GIS/Coverage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>!date
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>samedi 4 novembre 2017, 22:47:17 (UTC+0100)
</pre></div>
</div>
<div class="section" id="outdoor-coverage-knife-edge-model">
<h1>Outdoor Coverage Knife-Edge Model<a class="headerlink" href="#outdoor-coverage-knife-edge-model" title="Permalink to this headline">¶</a></h1>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>from pylayers.gis.ezone import *
import matplotlib.tri as tri
%matplotlib inline
</pre></div>
</div>
<p>We load a earth zone from its name in srtm file convention</p>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>z = Ezone(&#39;N48W002&#39;)
z.loadh5()
z.rebase()
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span># x,y,r,R,dem,LOS,h_earth,diff,fac,nu,numax,LFS,Ltot= z.cov(pc=(11000,45000),Ht=2,Hr=2,Rmax=10000)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>pc=(11000,45000)
Rmax = 10000
fGHz=0.3
Ht = 2
Hr =2
K = 4/3.
Nphi = 45
Nr = 50
</pre></div>
</div>
<p>Then the coverage zone is defined</p>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>lmbda = 0.3/fGHz
phi  = np.linspace(0,2*np.pi,Nphi)[:,None]
r  = np.linspace(0,Rmax,Nr)[None,:]
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span> # cartesian
x  = pc[0] + r*np.cos(phi)
y  = pc[1] + r*np.sin(phi)
extent_c = np.array([x.min(),x.max(),y.min(),y.max()])
lon,lat = z.m(x,y,inverse=True)
# Triangulation
triang = tri.Triangulation(x.flatten(),y.flatten())
# back in lon,lat coordinates
triang.x = x
triang.y = y
rx = np.round((lon - z.extent[0]) / z.lonstep).astype(int)
ry = np.round((z.extent[3]-lat) / z.latstep).astype(int)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>x.max()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>21000.0
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>x.min()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1000.0
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span> # dem
dem = z.hgts[ry,rx]
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>dem.shape
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(45, 50)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>X=expand(x)
Y=expand(y)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>X0=expand(pc[0]*np.ones((Nphi,Nr)))
Y0=expand(pc[1]*np.ones((Nphi,Nr)))
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>R=np.sqrt((X0-X)**2+(Y0-Y)**2)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>R.shape
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(45, 49, 50)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.plot(R[0,8,:],&#39;or&#39;)
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f12d07c5790&gt;]
</pre></div>
</div>
<img alt="../../_images/Coverage_18_1.png" src="../../_images/Coverage_18_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>r
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([[     0.        ,    204.08163265,    408.16326531,    612.24489796,
           816.32653061,   1020.40816327,   1224.48979592,   1428.57142857,
          1632.65306122,   1836.73469388,   2040.81632653,   2244.89795918,
          2448.97959184,   2653.06122449,   2857.14285714,   3061.2244898 ,
          3265.30612245,   3469.3877551 ,   3673.46938776,   3877.55102041,
          4081.63265306,   4285.71428571,   4489.79591837,   4693.87755102,
          4897.95918367,   5102.04081633,   5306.12244898,   5510.20408163,
          5714.28571429,   5918.36734694,   6122.44897959,   6326.53061224,
          6530.6122449 ,   6734.69387755,   6938.7755102 ,   7142.85714286,
          7346.93877551,   7551.02040816,   7755.10204082,   7959.18367347,
          8163.26530612,   8367.34693878,   8571.42857143,   8775.51020408,
          8979.59183673,   9183.67346939,   9387.75510204,   9591.83673469,
          9795.91836735,  10000.        ]])
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>B=r.T[None,1:]-R
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(B[0,:,:],cmap=plt.cm.jet,vmax=10000)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12d3d8af10&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_21_1.png" src="../../_images/Coverage_21_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>h_earth=(R*B)/(2*K*6375e3)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(h_earth[0,:,:],cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12d04f7510&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_23_1.png" src="../../_images/Coverage_23_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span># ground height + antenna height
Ha = expand((Ht + z.hgts[ry[0,0],rx[0,0]])*np.ones((Nphi,Nr)))
Hb = expand(Hr + dem)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span># LOS line
LOS  = Ha+(Hb-Ha)*R/r.T[None,1:]
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>LOS.shape
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(45, 49, 50)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(LOS[0,:,:],cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12d0350510&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_27_1.png" src="../../_images/Coverage_27_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>diff = expand(dem)+h_earth-LOS
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(diff[0,:,:],cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12d0229b10&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_29_1.png" src="../../_images/Coverage_29_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>fac  = np.sqrt(2*r.T[None,1:]/(lmbda*R*B))
nu   = diff*fac
#num,ind  = maxloc(nu)
numax = np.nanmax(nu,axis=2)
u = np.where(numax&gt;-0.7)
w = numax -0.1
L = np.zeros(w.shape)
L[u] = 6.9 + 20*np.log10(np.sqrt(w[u]**2+1)-w[u])
LFS = 32.4 + 20*np.log10(r[0,1:])+20*np.log10(fGHz)
Ltot = LFS+L
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/home/uguen/anaconda2/lib/python2.7/site-packages/ipykernel_launcher.py:1: RuntimeWarning: divide by zero encountered in divide
  &quot;&quot;&quot;Entry point for launching an IPython kernel.
/home/uguen/anaconda2/lib/python2.7/site-packages/ipykernel_launcher.py:1: RuntimeWarning: invalid value encountered in sqrt
  &quot;&quot;&quot;Entry point for launching an IPython kernel.
/home/uguen/anaconda2/lib/python2.7/site-packages/ipykernel_launcher.py:2: RuntimeWarning: invalid value encountered in multiply
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>numax
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([[       -inf, -0.48965701, -0.28230755, ...,  0.24972005,
         0.25062671,  0.25151559],
       [       -inf, -0.41965701, -0.32272207, ...,  0.24151194,
         0.24269898,  0.24386059],
       [       -inf, -0.41965701, -0.20147851, ...,  0.35027767,
         0.35234104,  0.35434705],
       ...,
       [       -inf, -0.48965701, -0.12064947, ...,  0.55829095,
         0.56043653,  0.56251895],
       [       -inf, -0.48965701, -0.28230755, ...,  0.27134908,
         0.27288219,  0.27437836],
       [       -inf, -0.48965701, -0.28230755, ...,  0.24972005,
         0.25062671,  0.25151559]])
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>Ltot.shape
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(45, 49)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>LOS.shape
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(45, 49, 50)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.figure(figsize=(15,8))
plt.imshow(dem,cmap=plt.cm.jet)
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f12d016aad0&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_34_1.png" src="../../_images/Coverage_34_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.figure(figsize=(15,8))
plt.imshow(Ltot,cmap=plt.cm.jet)
plt.colorbar()
plt.axis(&#39;auto&#39;)
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(-10.0, 50.0, 50.0, -10.0)
</pre></div>
</div>
<img alt="../../_images/Coverage_35_1.png" src="../../_images/Coverage_35_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>u=np.argmax(nu,axis=2)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(nu[0,:,:],vmin=-0.3,vmax=0.3,cmap=plt.cm.BrBG)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12d048f650&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_37_1.png" src="../../_images/Coverage_37_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>#plt.plot(h_earth[0,30,:])
#plt.plot(LOS[0,30,:])
#plt.plot(diff[0,30,:])
#plt.plot(dem[0,:])
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>#plt.plot(nu[0,30,:])
#plt.ylim(0,1)
#plt.plot(8,nu[0,30,8],&#39;or&#39;)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>nu.shape
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(45, 49, 50)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>numax2=np.nanmax(nu,axis=2)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>numax2.shape
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(45, 49)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(numax2,cmap=plt.cm.jet,vmin=-1.4)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12ce6d6c50&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_43_1.png" src="../../_images/Coverage_43_1.png" />
<p>imax indique le point d’engagement maximum</p>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>imax=np.nanargmax(nu,axis=2)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>imax
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([[ 0,  1,  2, ...,  4,  4,  4],
       [ 0,  1,  2, ...,  6,  6,  6],
       [ 0,  1,  2, ..., 10, 10, 10],
       ...,
       [ 0,  1,  2, ...,  8,  8,  8],
       [ 0,  1,  2, ...,  8,  8,  8],
       [ 0,  1,  2, ...,  4,  4,  4]])
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(imax,cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12ce5a34d0&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_47_1.png" src="../../_images/Coverage_47_1.png" />
<p>Recherche des coordonn??es du point diffractant pour toutes les
directions et pour tous les ranges.</p>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>imax.shape
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(45, 49)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>iphi = np.arange(Nphi)[:,None]
it = np.arange(0,Nr-1)[None,:]
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(imax,cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12ce47cc50&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_51_1.png" src="../../_images/Coverage_51_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>for k in range(2,Nphi-1):
    for l in range(1,Nr-1):
        if imax[k,l]!=0:
            t1 = np.arange(0,1,imax[k,l])
            t2 = np.arange(1,0,Nr-imax[k,l])
            t = np.hstack((t1,t2))
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>XM = x[iphi,imax[iphi,it]]
YM = y[iphi,imax[iphi,it]]
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>XM.shape
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(45, 49)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(XM,cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12ce2e8150&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_55_1.png" src="../../_images/Coverage_55_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(YM,cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12ce1bd990&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_56_1.png" src="../../_images/Coverage_56_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.figure(figsize=(20,20))
ik = 3
#plt.tripcolor(triang,dem.flatten())
f,a,d=z.show(coord=&#39;cartesian&#39;,extent=extent_c)
a.plot(XM[:,ik],YM[:,ik],&#39;.r&#39;)
a.plot(x[:,ik],y[:,ik],&#39;.b&#39;)
#plt.axis(&#39;equal&#39;)
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f12ce0799d0&gt;]
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.figure.Figure at 0x7f12ce6540d0&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_57_2.png" src="../../_images/Coverage_57_2.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>RF=np.sqrt((XM[...,None]-x[:,None,:])**2+(YM[...,None]-y[:,None,:])**2)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(RF[0,:,:],cmap=plt.cm.jet)
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f12cdec30d0&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_59_1.png" src="../../_images/Coverage_59_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.plot(x[0,:],y[0,:])
plt.plot(XM[0,:],YM[0,:],&#39;or&#39;)
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f12cde5cf50&gt;]
</pre></div>
</div>
<img alt="../../_images/Coverage_60_1.png" src="../../_images/Coverage_60_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>RF.shape
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(45, 49, 50)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>P=RF[:,0:-1,:]-RF[:,1:,:]
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>import numpy as np
import time
import pdb
from numba import jit
@jit
def splitMDA(imax):
    Nphi,Nl = imax.shape
    N = Nphi*Nl*(Nl+1)
    Ntot = imax.sum()
    u = np.empty((3,Ntot),dtype=int)
    #u1 = np.empty(Ntot)
    #u2 = np.empty(Ntot)
    v = np.empty((3,N-Ntot),dtype=int)
    #v1 = np.empty(N-Ntot)
    #v2 = np.empty(N-Ntot)
    indu = 0
    indv = 0
    for ip in range(Nphi):
        for il in range(Nl):
            for k in range(Nr):
                if k&lt;imax[ip,il]:
                    u[0,indu] = ip
                    u[1,indu] = il
                    u[2,indu] = k
                    indu = indu+1
                else:
                    v[0,indv] = ip
                    v[1,indv] = il
                    v[2,indv] = k
                    indv = indv+1
    #return (u0,u1,u2),(v0,v1,v2)
    return u,v

tic = time.time()
u,v = splitMDA(imax)
toc=time.time()
print toc-tic
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.395106077194
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.plot(RF[0,4,:])
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f12c57eb950&gt;]
</pre></div>
</div>
<img alt="../../_images/Coverage_64_1.png" src="../../_images/Coverage_64_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>UL=np.zeros(RF.shape)
UR=np.zeros(RF.shape)
UL[(u[0,:],u[1,:],u[2,:])]=RF[(u[0,:],u[1,:],u[2,:])]
UR[(v[0,:],v[1,:],v[2,:])]=RF[(v[0,:],v[1,:],v[2,:])]
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.plot(UL[0,4,:])
plt.plot(UR[0,4,:],&#39;r&#39;)
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f12cde65490&gt;]
</pre></div>
</div>
<img alt="../../_images/Coverage_66_1.png" src="../../_images/Coverage_66_1.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>import numpy as np
import time
import pdb
from numba import jit
@jit
def splitMDA(imax):
    Nphi,Nl = imax.shape
    N = Nphi*Nl*(Nl+1)
    Ntot = imax.sum()
    u = np.empty((3,Ntot),dtype=int)
    #u1 = np.empty(Ntot)
    #u2 = np.empty(Ntot)
    v = np.empty((3,N-Ntot),dtype=int)
    #v1 = np.empty(N-Ntot)
    #v2 = np.empty(N-Ntot)
    indu = 0
    indv = 0
    for ip in range(Nphi):
        for il in range(Nl):
            for k in range(Nr):
                if k&lt;imax[ip,il]:
                    u[0,indu] = ip
                    u[1,indu] = il
                    u[2,indu] = k
                    indu = indu+1
                else:
                    v[0,indv] = ip
                    v[1,indv] = il
                    v[2,indv] = k
                    indv = indv+1
    #return (u0,u1,u2),(v0,v1,v2)
    return u,v

tic = time.time()
u,v = splitMDA(imax)
toc=time.time()
print toc-tic
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.28248000145
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>import numpy as np
import time
import pdb
from numba import jit
#@jit
def cover(dem,X,Y,Ha,Hb,fGHz):
    Nphi,Nl = dem.shape
    #pdb.set_trace()
    print Nphi,Nl
    L = np.zeros((Nphi,Nl,Nl+1))
    for ip in range(Nphi):
        for il in range(Nl):
            uk = range(1,il+2)
            z = np.empty(len(uk))
            for k in uk:
                x = X[ip,:k]
                y = Y[ip,:k]
                z[:k] = dem[ip,:k]
            d = np.sqrt((x-x[0])**2+(y-y[0])**2)
            u = np.arange(len(z))/(len(z)-1.0)
            z[0]  = z[0] + Ha
            z[-1] = z[-1] + Hb
            plt.plot(d,z)
            L[ip,il,k]=interv(z,d,fGHz,0,0)
    return(L)

#@jit
def interv(z,d,fGHz,L,depth):
    lmbda = 0.3/fGHz
    depth = depth+1
    if depth &lt;3:
        if len(z)&gt;3:
            u = np.arange(len(z))/(len(z)-1.0)
            l = (z[0])*(1-u)+(z[-1])*u
            h = z[1:-1]-l[1:-1]
            nu = h*np.sqrt((2/lmbda)*(1/d[1:-1]+1/(d[-1]-d[1:-1])))
            imax = np.nanargmax(nu)
            numax = nu[imax]
        else:
            numax = -10
        if numax&gt;-0.78:
            w  = numax -0.1
            L  = L + 6.9 + 20*np.log10(np.sqrt(w**2+1)+w)
            z1 = z[0:imax]
            d1 = d[0:imax]
            Ll = interv(z1,d1,fGHz,0,depth)
            z2 = z[imax:]
            d2 = d[imax:]

            Lr = interv(z2,d2,fGHz,0,depth)

            L  = L+Lr+Ll
    return(L)
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>tic = time.time()
L=cover(dem,x,y,1,1,2)
toc=time.time()
print toc-tic
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>45 50
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/home/uguen/anaconda2/lib/python2.7/site-packages/ipykernel_launcher.py:20: RuntimeWarning: invalid value encountered in divide
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2.30528688431
</pre></div>
</div>
<img alt="../../_images/Coverage_69_3.png" src="../../_images/Coverage_69_3.png" />
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>x
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([[ 11000.        ,  11204.08163265,  11408.16326531, ...,
         20591.83673469,  20795.91836735,  21000.        ],
       [ 11000.        ,  11202.00437589,  11404.00875179, ...,
         20494.20566702,  20696.21004292,  20898.21441881],
       [ 11000.        ,  11195.81489257,  11391.62978515, ...,
         20203.299951  ,  20399.11484357,  20594.92973614],
       ...,
       [ 11000.        ,  11195.81489257,  11391.62978515, ...,
         20203.299951  ,  20399.11484357,  20594.92973614],
       [ 11000.        ,  11202.00437589,  11404.00875179, ...,
         20494.20566702,  20696.21004292,  20898.21441881],
       [ 11000.        ,  11204.08163265,  11408.16326531, ...,
         20591.83673469,  20795.91836735,  21000.        ]])
</pre></div>
</div>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>plt.imshow(L[0,:,:],cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12be98b610&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_71_1.png" src="../../_images/Coverage_71_1.png" />
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../2-AP/SlabsMaterials.html" class="btn btn-neutral float-right" title="Slabs and Materials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Ezone.html" class="btn btn-neutral" title="Geographical Information and the Earth Zone class : Ezone" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, PyLayers developer team.
      Last updated on Jan 29, 2019.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>