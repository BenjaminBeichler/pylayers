

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pylayers.mobility.agent &mdash; PyLayers</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Python
          

          
            
            <img src="../../../_static/pylayers.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout1.html">Loading an outdoor layout from its address</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_antenna.html">Antenna Pattern for an H plane sectoral antenna &#64; 32GHz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout2.html">Building graphs of a Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_coverage.html">Indoor Radio Coverage with Motley Keenan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_layout.html">8 Random Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_issue314.html">Exemple of issue 314</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exAbsGas.html">Attenuation due to atmospheric gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exDLink.html">Evaluation of a radio link DLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_w1.html">Indoor Radio Coverage FP7 WHERE1 M1 setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLuebbers.html">UWB Ray tracing simulation  in outdoor scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_dakar.html">Outdoor Radio Coverage with Deygout Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_cover.html">Outdoor Radio Coverage with Deygout Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction_polar.html">Diffraction coefficient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction.html">Diffraction coefficient</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pylayers.mobility.agent</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pylayers.mobility.agent</h1><div class="highlight"><pre>
<span></span>&quot;&quot;&quot;
.. automodule::
    :members:

Agent Class
==================

.. autoclass:: Agent
    :members:

&quot;&quot;&quot;
import sys
import time
import pdb

if sys.version_info.major==2:
    import ConfigParser
    from SimPy.SimulationRT import Simulation
else:
    import configparser as ConfigParser
    import simpy

from pylayers.mobility.transit.Person import Person
from pylayers.mobility.transit.World import world
from pylayers.mobility.transit.SteeringBehavior import Seek, Separation, Containment, InterpenetrationConstraint, queue_steering_mind

import numpy as np
import networkx as nx
import pandas as pd
import pylayers.util.pyutil as pyu
from pylayers.network.network import Node, Network
from pylayers.network.communication import Gcom, TX, RX
from pylayers.location.localization import Localization, PLocalization
from pylayers.gis.layout import Layout
from pylayers.util.utilnet import *
#from pylayers.util.pymysqldb import Database
&quot;&quot;&quot;&quot;

.. currentmodule:: pylayers.mobility.agent

.. autosummary::
    :toctree: generated/

&quot;&quot;&quot;

<div class="viewcode-block" id="Agent"><a class="viewcode-back" href="../../../api/pylayers.mobility.agent.Agent.html#pylayers.mobility.agent.Agent">[docs]</a>class Agent(object):
    &quot;&quot;&quot;   Class Agent

    Members
    -------

    args
    ID
    name
    typ
    net
    epwr
    gcom
    sim
    wstd
    sens
    dcond
    meca : transit.Person
    net : pylayers.network.Network
    sim :
    PN :
    rxt
    rxr



    &quot;&quot;&quot;

    def __init__(self, **args):
        &quot;&quot;&quot; Mobile Agent Init

           Parameters
           ----------

           &#39;ID&#39;: string
                agent ID
           &#39;name&#39;: string
                Agent name
           &#39;typ&#39;: string
                agent typ . &#39;ag&#39; for moving agent, &#39;ap&#39; for static acces point
           &#39;pos&#39; : np.array([])
                numpy array containing the initial position of the agent
           &#39;roomId&#39;: int
                Room number where the agent is initialized (Layout.Gr)
           &#39;meca_updt&#39;: float
                update time interval for the mechanical process
           &#39;loc&#39;: bool
                enable/disable localization process of the agent
           &#39;loc_updt&#39;: float
                update time interval for localization process
           &#39;L&#39;: pylayers.gis.Layout()
           &#39;net&#39;:pylayers.network.Network(),
           &#39;wstd&#39;: list of string
                list of used radio access techology of the agent
           &#39;world&#39;: transit.world()
                Soon deprecated
           &#39;save&#39;: list of string
                list of save method ( soon deprecated)
           &#39;sim&#39;:Simpy.SimulationRT.Simulation(),
           &#39;epwr&#39;: dictionnary
                dictionnary of emmited power of transsmitter{&#39;wstd#&#39;:epwr value}
           &#39;sens&#39;: dictionnary
                dictionnary of sensitivity of reveicer {&#39;wstd#&#39;:sens value}
           &#39;dcond&#39;: dictionnary
                Not used yet
           &#39;gcom&#39;:pylayers.communication.Gcom()
                Communication graph
           &#39;comm_mod&#39;: string
                Communication between nodes mode:
                &#39;autonomous&#39;: all TOAs are refreshed regulary
                &#39;synchro&#39; : only visilbe TOAs are refreshed
        &quot;&quot;&quot;
        defaults = {&#39;ID&#39;: &#39;0&#39;,
                    &#39;name&#39;: &#39;johndoe&#39;,
                    &#39;typ&#39;: &#39;ag&#39;,
                    &#39;color&#39;: &#39;k&#39;,
                    &#39;pdshow&#39;: False,
                    &#39;pos&#39;: np.array([]),
                    &#39;roomId&#39;: -1,
                    &#39;froom&#39;: [],
                    &#39;wait&#39;: [],
                    &#39;seed&#39;: 0,
                    &#39;cdest&#39;: &#39;random&#39;,
                    &#39;meca_updt&#39;: 0.1,
                    &#39;loc&#39;: False,
                    &#39;loc_updt&#39;: 0.5,
                    &#39;loc_method&#39;: [&#39;geo&#39;],
                    &#39;L&#39;: Layout(),
                    &#39;network&#39;: True,
                    &#39;net&#39;: Network(),
                    &#39;wstd&#39;: [&#39;rat1&#39;],
                    &#39;world&#39;: world(),
                    &#39;save&#39;: [],
                    &#39;sim&#39;: simpy.Environment(),
                    &#39;epwr&#39;: {},
                    &#39;sens&#39;: {},
                    &#39;dcond&#39;: {},
                    &#39;gcom&#39;: Gcom(),
                    &#39;comm_mode&#39;: &#39;autonomous&#39;}

        for key, value in defaults.items():
            if key not in args:
                args[key] = value

        self.args = args
        self.ID = args[&#39;ID&#39;]
        self.name = args[&#39;name&#39;]
        self.typ = args[&#39;typ&#39;]
        # Create Network
        self.net = args[&#39;net&#39;]
        self.epwr = args[&#39;epwr&#39;]
        self.gcom = args[&#39;gcom&#39;]
        self.sim = args[&#39;sim&#39;]
        self.wstd = args[&#39;wstd&#39;]
        if args[&#39;epwr&#39;] == {}:
            self.epwr = {x: 0 for x in self.wstd}
        else:
            self.epwr = args[&#39;epwr&#39;]

        if args[&#39;sens&#39;] == {}:
            self.sens = {x: -180 for x in self.wstd}
        else:
            self.sens = args[&#39;sens&#39;]

        try:
            self.dcond = args[&#39;dcond&#39;]
        except:
            pass

        # check if node id already given
        if self.ID in self.net.nodes():
            raise NameError(
                &#39;another agent has the ID: &#39; + self.ID + &#39; .Please use an other ID&#39;)

        if self.typ == &#39;ag&#39;:
            # mechanical init
            self.meca = Person(ID=self.ID,
                               color=args[&#39;color&#39;],
                               pdshow=args[&#39;pdshow&#39;],
                               roomId=args[&#39;roomId&#39;],
                               L=args[&#39;L&#39;],
                               net=self.net,
                               interval=args[&#39;meca_updt&#39;],
                               wld=args[&#39;world&#39;],
                               sim=args[&#39;sim&#39;],
                               seed=args[&#39;seed&#39;],
                               moving=True,
                               froom=args[&#39;froom&#39;],
                               wait=args[&#39;wait&#39;],
                               cdest=args[&#39;cdest&#39;],
                               save=args[&#39;save&#39;]
                               )
            self.meca.behaviors = [Seek(), Containment(),
                                   Separation(), InterpenetrationConstraint()]
            self.meca.steering_mind = queue_steering_mind
            # Network init
            self.node = Node(ID=self.ID,name=self.name, p=conv_vecarr(self.meca.position),
                             t=self.sim.now(), wstd=args[&#39;wstd&#39;],
                             epwr=self.epwr, sens=self.sens, typ=self.typ)
            self.net.add_nodes_from(self.node.nodes(data=True))

            self.sim.activate(self.meca, self.meca.move(), 0.0)
            self.PN = self.net.node[self.ID][&#39;PN&#39;]

            # Communication init

            if args[&#39;comm_mode&#39;] == &#39;synchro&#39; and args[&#39;network&#39;]:
                # The TOA requests are made every refreshTOA time ( can be modified in agent.ini)
                # This Mode will be deprecated in future version

                self.rxr = RX(net=self.net,
                              ID=self.ID,
                              dcond=self.dcond,
                              gcom=self.gcom,
                              sim=self.sim)

                self.rxt = RX(net=self.net,
                              ID=self.ID,
                              dcond=self.dcond,
                              gcom=self.gcom,
                              sim=self.sim)

                self.sim.activate(self.rxr, self.rxr.refresh_RSS(), 0.0)
                self.sim.activate(self.rxt, self.rxt.refresh_TOA(), 0.0)

            elif args[&#39;comm_mode&#39;] == &#39;autonomous&#39; and args[&#39;network&#39;]:
                # The requests are made by node only when they are in
                # visibility of pairs.

                # self.rxr only manage a refresh RSS process
                self.rxr = RX(net=self.net, ID=self.ID,
                              gcom=self.gcom, sim=self.sim)
                # self.tx manage all requests to other nodes
                self.tx = TX(net=self.net, ID=self.ID,
                             gcom=self.gcom, sim=self.sim)
                # self.tx replies to  requests from self.tx
                self.rx = RX(net=self.net, ID=self.ID,
                             gcom=self.gcom, sim=self.sim)

                self.sim.activate(self.rxr, self.rxr.refresh_RSS(), 0.0)
                self.sim.activate(self.tx, self.tx.request(), 0.0)
                self.sim.activate(self.rx, self.rx.wait_request(), 0.0)

        elif self.typ == &#39;ap&#39;:
            if args[&#39;roomId&#39;] == -1:
                self.node = Node(ID=self.ID, p=self.args[&#39;pos&#39;],
                                 t=self.sim.now(), wstd=args[&#39;wstd&#39;],
                                 epwr=self.epwr, sens=self.sens, typ=self.typ)
            else:
                pp = np.array(args[&#39;L&#39;].Gr.pos[self.args[&#39;roomId&#39;]])
                self.node = Node(
                    ID=self.ID, p=pp, t=self.sim.now(), wstd=args[&#39;wstd&#39;],
                    epwr=self.epwr, sens=self.sens, typ=self.typ)
            self.net.add_nodes_from(self.node.nodes(data=True))
            self.sim = args[&#39;sim&#39;]

            self.PN = self.net.node[self.ID][&#39;PN&#39;]
            self.PN.node[self.ID][&#39;pe&#39;] = self.net.node[self.ID][&#39;p&#39;]
            if args[&#39;comm_mode&#39;] == &#39;autonomous&#39; and args[&#39;network&#39;]:
                self.rx = RX(net=self.net, ID=self.ID,
                             gcom=self.gcom, sim=self.sim)
                self.sim.activate(self.rx, self.rx.wait_request(), 0.0)

            p = self.args[&#39;pos&#39;]
            self.posdf = pd.DataFrame(
                {&#39;t&#39;: pd.Timestamp(0), &#39;x&#39;: p[0], &#39;y&#39;: p[1], &#39;z&#39;: p[2],
                                       &#39;vx&#39;: np.array([0.0]), &#39;vy&#39;: np.array([0.0]),
                                       &#39;ax&#39;: np.array([0.0]), &#39;ay&#39;: np.array([0.0]),
                 }, columns=[&#39;t&#39;, &#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;vx&#39;, &#39;vy&#39;, &#39;ax&#39;, &#39;ay&#39;], index=np.array([0]))

        else:
            raise NameError(
                &#39;wrong agent typ, it must be either agent (ag) or acces point (ap) &#39;)

        if self.typ == &#39;ap&#39;:
            self.MoA = 1
        else:
            self.MoA = 0

        if &#39;mysql&#39; in args[&#39;save&#39;]:
            config = ConfigParser.ConfigParser()
            config.read(pyu.getlong(&#39;simulnet.ini&#39;, &#39;ini&#39;))
            sql_opt = dict(config.items(&#39;Mysql&#39;))
            db = Database(sql_opt[&#39;host&#39;], sql_opt[&#39;user&#39;],
                          sql_opt[&#39;passwd&#39;], sql_opt[&#39;dbname&#39;])
            db.writenode(self.ID, self.name, self.MoA)

        if &#39;txt&#39; in args[&#39;save&#39;]:
            pyu.writenode(self)
        if self.typ != &#39;ap&#39; and args[&#39;loc&#39;]:

            self.loc = Localization(net=self.net, ID=self.ID,
                                    method=args[&#39;loc_method&#39;])
            self.Ploc = PLocalization(loc=self.loc,
                                      loc_updt_time=args[&#39;loc_updt&#39;],
                                      tx=self.tx,
                                      sim=args[&#39;sim&#39;])

            self.sim.activate(self.Ploc, self.Ploc.run(), 1.5)

    def __repr__(self):
        s = &#39;General Agent info \n********************\n&#39;
        s = s + &#39;name : &#39; + self.name + &#39;\n&#39;
        s = s + &#39;ID: &#39; + self.ID + &#39;\n&#39;
        s = s + &#39;typ: &#39; + self.typ

        s = s + &#39;\n\n More Agent information about:&#39;
        s = s + &#39;\n+ Mecanichal =&gt; self.meca&#39;

        s = s + &#39;\n+ Network =&gt; self.net&#39;
        s = s + &#39;\n+ Personnal Network =&gt; self.PN&#39;
        s = s + &#39;\n+ Localization =&gt; self.loc\n\n&#39;

        try:
            s = s + self.PN.__repr__() + &#39;\n\n&#39;
        except:
            s = s + &#39;No network simulated&#39;

        if self.typ != &#39;ap&#39;:
            s = s + self.meca.__repr__() + &#39;\n\n&#39;
            try:
                s = s + self.loc.__repr__() + &#39;\n\n&#39;
            except:
                s = s + &#39;no localization simulated&#39;

        return s</div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, PyLayers developer team
      <span class="lastupdated">
        Last updated on Apr 02, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>