

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pylayers.simul.exploit &mdash; PyLayers</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Python
          

          
            
            <img src="../../../_static/pylayers.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout1.html">Loading an outdoor layout from its address</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_antenna.html">Antenna Pattern for an H plane sectoral antenna &#64; 32GHz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout2.html">Building graphs of a Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_coverage.html">Indoor Radio Coverage with Motley Keenan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_layout.html">8 Random Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_issue314.html">Exemple of issue 314</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exAbsGas.html">Attenuation due to atmospheric gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exDLink.html">Evaluation of a radio link DLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_w1.html">Indoor Radio Coverage FP7 WHERE1 M1 setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLuebbers.html">UWB Ray tracing simulation  in outdoor scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_dakar.html">Outdoor Radio Coverage with Deygout Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_cover.html">Outdoor Radio Coverage with Deygout Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction_polar.html">Diffraction coefficient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction.html">Diffraction coefficient</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pylayers.simul.exploit</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pylayers.simul.exploit</h1><div class="highlight"><pre>
<span></span>from __future__ import print_function
from pylayers.util import project
from pylayers.signal.bsignal import *
import pylayers.util.pyutil as pyu
import sys

if sys.version_info.major==2:
    import ConfigParser
else:
    import configparser as ConfigParser

import matplotlib.pylab as plt
import itertools
import pdb
r&quot;&quot;&quot;

.. currentmodule:: pylayers.simul.exploit

.. autosummary::

&quot;&quot;&quot;

<div class="viewcode-block" id="Exploit"><a class="viewcode-back" href="../../../api/pylayers.simul.exploit.Exploit.html#pylayers.simul.exploit.Exploit">[docs]</a>class Exploit(object):
    &quot;&quot;&quot; class Exploit

    Methods
    -------

    load


    &quot;&quot;&quot;
    def __init__(self,simnetfile=&#39;simulnet.ini&#39;):
        self.simnetfile=simnetfile
        self.load()

<div class="viewcode-block" id="Exploit.load"><a class="viewcode-back" href="../../../api/pylayers.simul.exploit.Exploit.html#pylayers.simul.exploit.Exploit.load">[docs]</a>    def load(self):
        &quot;&quot;&quot;
        Load simulnet_data configuration file
        &quot;&quot;&quot;
        self.simcfg = ConfigParser.ConfigParser()
        self.simcfg.read(pyu.getlong(self.simnetfile,pstruc[&#39;DIRNETSAVE&#39;]))
        pdb.set_trace()
        self.Lfilename = self.simcfg.get(&#39;layout&#39;,&#39;layoutname&#39;)
        self.lAG = eval(self.simcfg.get(&#39;nodes&#39;,&#39;ag&#39;))
        self.lAP = eval(self.simcfg.get(&#39;nodes&#39;,&#39;ap&#39;))
        self.uptime = eval(self.simcfg.get(&#39;simulation&#39;,&#39;updatetime&#39;))
        # create a Simul object with the correct layout
        self.S = Simul()
        self.S.layout(self.Lfilename,&#39;matDB.ini&#39;,&#39;slabDB.ini&#39;)
        self.lap = len(self.lAP)
        self.lag = len(self.lAG)

        self.L = self.S.L
        try:
            self.L.dumpr()
            print(&#39;Layout graphs are loaded from &#39;,basename,&#39;/struc&#39;)
        except:
        #self.L.sl = sl
        #self.L.loadGr(G1)            
            print(&#39;First time your use the Layout.Graphs are curently build, it may take few minutes.&#39;)
            self.L.buildGt()
            self.L.dumpw()</div>



<div class="viewcode-block" id="Exploit.compute"><a class="viewcode-back" href="../../../api/pylayers.simul.exploit.Exploit.html#pylayers.simul.exploit.Exploit.compute">[docs]</a>    def compute(self):
        &quot;&quot;&quot;
        Compute Raytracing simulation with the given simulation files 
        &quot;&quot;&quot;
        #
        ### STEP 1 : all mobile node with all agent
        #

        self.S.clean_project(verbose=True)

        for apidx,ap in enumerate(self.lAP):
            self.S.tx = RadioNode(typ=&#39;tx&#39;,name=ap)
            self.S.tx.loadini(ap+&#39;.ini&#39;,rep=pstruc[&#39;DIRNETSAVE&#39;])
            for agidx,ag in enumerate(self.lAG):
                print(&#39;---------------------&#39;)
                print(&#39; Raytracing for :    &#39;)
                print(&#39; AP #&#39;,self.lAP[apidx-1] ,&#39; / AG #&#39;,ag)
                print(&#39;---------------------&#39;)
                print(&#39; Computed :&#39;)
                print(&#39;AP:&#39;,apidx-1,&#39;/&#39;,self.lap+1)
                print(&#39;AG:&#39;,agidx,&#39;/&#39;,self.lag)
                print(&#39;---------------------&#39;)
                self.S.rx = RadioNode(typ=&#39;rx&#39;,name=ag)
                self.S.rx.loadini(ag+&#39;.ini&#39;,rep=pstruc[&#39;DIRNETSAVE&#39;])
                self.S.run(apidx+1,range(1,self.S.rx.N+1))

        #### STEP 2 : all mobile/mobile

        icag = itertools.combinations(self.lAG,2)
        for cag in icag:
            self.S.tx = RadioNode(typ=&#39;tx&#39;,name=cag[0])
            self.S.tx.loadini(cag[0]+&#39;.ini&#39;,rep=pstruc[&#39;DIRNETSAVE&#39;])
            self.S.rx = RadioNode(typ=&#39;tx&#39;,name=cag[1])
            self.S.rx.loadini(cag[1]+&#39;.ini&#39;,rep=pstruc[&#39;DIRNETSAVE&#39;])
            lidxpts = range(1,self.S.rx.N+1)
            print(&#39;---------------------&#39;)
            print(&#39; Raytracing for :    &#39;)
            print(&#39; AG #&#39;, cag[0] ,&#39; / AG #&#39;,cag[1])
            print(&#39;---------------------&#39;)
            for n in lidxpts:
                print(&#39; trajectory point #&#39;,n,&#39;/&#39;,self.S.rx.N+1)
                print(&#39;---------------------&#39;)
                self.S.run(n,n)</div>


<div class="viewcode-block" id="Exploit.pltcir"><a class="viewcode-back" href="../../../api/pylayers.simul.exploit.Exploit.html#pylayers.simul.exploit.Exploit.pltcir">[docs]</a>    def pltcir(self,itx,irx,pn,fig=[]):
        &quot;&quot;&quot; plot channel impulse response for Tx,Rx and a specified position

        Parameters
        ----------

        itx : int
            node number
        irx : int
            node number
        pn : int
            position index of the Rx
        fig : 

        &quot;&quot;&quot;
        if fig == []:
            fig = plt.figure(2)

        fig.clf()

        cir = TUsignal()
        spn = str(pn)
        line = &#39;defaultcir-&#39; +str(itx) +&#39;-&#39;+str(irx)+&#39;-p&#39;+spn.zfill(3)
        try:
            cir.readcir(line,str(itx))
        except:
            return False
        print(&#39;load : &#39;,line,&#39;.mat&#39;)
        cir.show(fig)
        return True</div>


<div class="viewcode-block" id="Exploit.pltciri"><a class="viewcode-back" href="../../../api/pylayers.simul.exploit.Exploit.html#pylayers.simul.exploit.Exploit.pltciri">[docs]</a>    def pltciri(self,itx,irx):
        &quot;&quot;&quot;
        plot channel impulse response interactively.
        display all nodes position of Tx and Rx and choose 
        for which link the CIR is displayed.

        Once self.pltciri(node1,node2) is called : 

        1) Press &#39;t&#39; on the displayed graph to chose the Tx
        2) Press &#39;x&#39; on the displayed graph to chose the Rx
        3) Press Enter to display CIR betwen Tx-Rx


        Parameters
        ----------
            itx : int
                node number
            irx : int
                node number

        usage
        &gt;&gt;&gt; W=W2()
        &gt;&gt;&gt; W.pltciri(6,1)

        &quot;&quot;&quot;
        plt.ion()
        fig1 = plt.figure(1)
        ax=fig1.add_subplot(111)
        self.ax2 = fig1.add_subplot(111)
        self.L.showG(fig=fig1,graph=&#39;&#39;)
        self.S.tx = RadioNode(typ=&#39;tx&#39;,name=itx)
        self.S.tx.loadini(str(itx)+&#39;.ini&#39;,rep=pstruc[&#39;DIRNETSAVE&#39;])
        self.S.rx = RadioNode(typ=&#39;rx&#39;,name=irx)
        self.S.rx.loadini(str(irx)+&#39;.ini&#39;,rep=pstruc[&#39;DIRNETSAVE&#39;])
        ax.plot(self.S.tx.position[0,:],self.S.tx.position[1,:],&#39;ob&#39;)
        ax.plot(self.S.rx.position[0,:],self.S.rx.position[1,:],&#39;or&#39;)
        plt.show()
        print( &#39;1. Press \&#39;t\&#39; and click to select a Tx &#39;)
        print( &#39;2. Press \&#39;x\&#39; and click to select a Rx &#39; ) 
        print( &#39;3. Press Enter to see the associated CIR &#39; ) 
        self.key=&#39;&#39;
        self.x1=&#39;&#39;
        self.x2=&#39;&#39;
        self.y1=&#39;&#39;
        self.y2=&#39;&#39;
        self.n1=&#39;&#39;
        self.n2=&#39;&#39;
        self.pos1=&#39;&#39;
        self.pos2=&#39;&#39;
        self.c1=[]
        self.c2=[]
        cid=fig1.canvas.mpl_connect(&#39;button_press_event&#39;, self.onclick)
        cid=fig1.canvas.mpl_connect(&#39;key_press_event&#39;, self.on_key)</div>

<div class="viewcode-block" id="Exploit.onclick"><a class="viewcode-back" href="../../../api/pylayers.simul.exploit.Exploit.html#pylayers.simul.exploit.Exploit.onclick">[docs]</a>    def onclick(self,event):
        &quot;&quot;&quot;
            Events on click
        &quot;&quot;&quot;
        if event.button == 1:
            print( self.key)
            if self.key ==&#39;t&#39;:
                self.x1 = event.xdata
                self.y1 = event.ydata
                self.n1,self.pos1=self.srchpoint(self.x1,self.y1)
                print( &#39;select node1(Tx) # &#39;,self.n1,)
            if self.key ==&#39;x&#39;:
                self.x2 = event.xdata
                self.y2 = event.ydata
                self.n2,self.pos2=self.srchpoint(self.x2,self.y2)
                print( &#39;select node2(Rx) # &#39;,self.n2, &#39;, at position #&#39;, self.pos2+1)
            if self.key == &#39;enter&#39;:
                pass</div>



<div class="viewcode-block" id="Exploit.on_key"><a class="viewcode-back" href="../../../api/pylayers.simul.exploit.Exploit.html#pylayers.simul.exploit.Exploit.on_key">[docs]</a>    def on_key(self,event):
        &quot;&quot;&quot;
            Events on key stroke
        &quot;&quot;&quot;
        if event.key == &#39;t&#39;:
            self.key = &#39;t&#39;
        if event.key == &#39;x&#39;:
            self.key = &#39;x&#39;
        if event.key == &#39;enter&#39;:
            inv=False
            case = &#39;&#39;
            if self.pos1 !=&#39;&#39; and self.pos2 !=&#39;&#39;:
                if self.n1 == self.n2:
                    print( &#39;ERROR :tx and rx on the same node&#39;)
                else :
                    if str(self.n1) in self.lAG and str(self.n2) in self.lAG:
                        upos = self.pos2[0]+1
                        case = &#39;2agents&#39;
                    elif str(self.n2) in self.lAP:
                        upos = self.pos1[0]+1
                    else :
                        upos = self.pos2[0]+1


                    if self.pltcir(self.n1,self.n2,upos):
                        pass
                    else: 
                        self.pltcir(self.n2,self.n1,upos)
                        inv=True
                        print( inv)

                    ### manage black cross for involved nodes
                    try:
                        self.c1.pop(0).remove()
                        self.c2.pop(0).remove()
                    except:
                        pass
         
                    if case == &#39;2agents&#39;:
                    ### manage 2 mobile nodes
                        self.c1=self.ax2.plot(self.S.tx.position[0,upos-1],self.S.tx.position[1,upos-1],&#39;xk&#39;,ms=10.,mew=3.)
                        self.c2=self.ax2.plot(self.S.rx.position[0,upos-1],self.S.rx.position[1,upos-1],&#39;xk&#39;,ms=10.,mew=3.)
                    else:
                        if self.S.tx.N == 1:
                            self.c1=self.ax2.plot(self.S.tx.position[0,0],self.S.tx.position[1,0],&#39;xk&#39;,ms=10.,mew=3.)
                            self.c2=self.ax2.plot(self.S.rx.position[0,upos-1],self.S.rx.position[1,upos-1],&#39;xk&#39;,ms=10.,mew=3.)
                        else :
                            self.c1=self.ax2.plot(self.S.tx.position[0,upos-1],self.S.tx.position[1,upos-1],&#39;xk&#39;,ms=10.,mew=3.)
                            self.c2=self.ax2.plot(self.S.rx.position[0,0],self.S.rx.position[1,0],&#39;xk&#39;,ms=10.,mew=3.)</div>

#                    ### manage 2 mobile nodes to take position of the 2nd click
#                    if str(self.S.tx.name) in self.lAG and str(self.S.rx.name) in self.lAG :
#                        self.pos1 = self.pos2
#                    

<div class="viewcode-block" id="Exploit.srchpoint"><a class="viewcode-back" href="../../../api/pylayers.simul.exploit.Exploit.html#pylayers.simul.exploit.Exploit.srchpoint">[docs]</a>    def srchpoint(self,x,y):
        &quot;&quot;&quot;
        Search from the closest point (x,y) into self.tx.position and self.rx.position
        
        Returns
        -------
            N : int
                node ID
            pos : int
                index of the closest position 
        &quot;&quot;&quot;
        t = self.S.tx.position[:2,:]
        r = self.S.rx.position[:2,:]
        p = np.array((x,y))
        d1 = np.sqrt(np.sum((t.T-p)**2,axis=1))
        d2 = np.sqrt(np.sum((r.T-p)**2,axis=1))
        d1m=np.min(d1)
        d2m=np.min(d2)
        if d1m &lt; d2m:
            n = self.S.tx.name
            pos = np.nonzero(d1==d1m)[0]
        else :
            n = self.S.rx.name
            pos = np.nonzero(d2==d2m)[0]
        return (n,pos)</div></div>
#cid = fig.canvas.mpl_connect(&#39;button_press_event&#39;, onclick)


if (__name__ == &quot;__main__&quot;):
    E=Exploit()
    E.compute()
    E.pltciri(1,2)

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, PyLayers developer team
      <span class="lastupdated">
        Last updated on Apr 02, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>