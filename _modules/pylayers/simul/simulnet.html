

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pylayers.simul.simulnet &mdash; PyLayers</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Python
          

          
            
            <img src="../../../_static/pylayers.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout1.html">Loading an outdoor layout from its address</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_antenna.html">Antenna Pattern for an H plane sectoral antenna &#64; 32GHz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout2.html">Building graphs of a Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_coverage.html">Indoor Radio Coverage with Motley Keenan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_layout.html">8 Random Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_issue314.html">Exemple of issue 314</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exAbsGas.html">Attenuation due to atmospheric gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exDLink.html">Evaluation of a radio link DLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_w1.html">Indoor Radio Coverage FP7 WHERE1 M1 setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLuebbers.html">UWB Ray tracing simulation  in outdoor scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction_polar.html">Diffraction coefficient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction.html">Diffraction coefficient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html">1&nbsp;&nbsp;&nbsp;pylayers.util.project Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.layout">2&nbsp;&nbsp;&nbsp;pylayers.gis.layout Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.selectl">3&nbsp;&nbsp;&nbsp;pylayers.gis.selectl Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.srtm">4&nbsp;&nbsp;&nbsp;pylayers.gis.srtm Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.osmparser">5&nbsp;&nbsp;&nbsp;pylayers.gis.osmparser Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.ezone">6&nbsp;&nbsp;&nbsp;pylayers.gis.ezone Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antenna">7&nbsp;&nbsp;&nbsp;pylayers.antprop.antenna Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.aarray">8&nbsp;&nbsp;&nbsp;pylayers.antprop.aarray Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.spharm">9&nbsp;&nbsp;&nbsp;pylayers.antprop.spharm Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antssh">10&nbsp;&nbsp;&nbsp;pylayers.antprop.antssh Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antvsh">11&nbsp;&nbsp;&nbsp;pylayers.antprop.antvsh Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.slab">12&nbsp;&nbsp;&nbsp;pylayers.antprop.slab Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.signature">13&nbsp;&nbsp;&nbsp;pylayers.antprop.signature Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.interactions">14&nbsp;&nbsp;&nbsp;pylayers.antprop.interactions Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.diffraction">15&nbsp;&nbsp;&nbsp;pylayers.antprop.diffraction Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.diffRT">16&nbsp;&nbsp;&nbsp;pylayers.antprop.diffRT Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.rays">17&nbsp;&nbsp;&nbsp;pylayers.antprop.rays Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.loss">18&nbsp;&nbsp;&nbsp;pylayers.antprop.loss Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.channel">19&nbsp;&nbsp;&nbsp;pylayers.antprop.channel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#id39">20&nbsp;&nbsp;&nbsp;pylayers.antprop.loss Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.coverage">21&nbsp;&nbsp;&nbsp;pylayers.antprop.coverage Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.coeffModel">22&nbsp;&nbsp;&nbsp;pylayers.antprop.coeffModel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.link">23&nbsp;&nbsp;&nbsp;pylayers.simul.link Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.exploit">24&nbsp;&nbsp;&nbsp;pylayers.simul.exploit Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.exploit_simulnet">25&nbsp;&nbsp;&nbsp;pylayers.simul.exploit_simulnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.simulnet">26&nbsp;&nbsp;&nbsp;pylayers.simul.simulnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.simultraj">27&nbsp;&nbsp;&nbsp;pylayers.simul.simultraj Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.exploit.simnet">28&nbsp;&nbsp;&nbsp;pylayers.exploit.simnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.mesuwb">29&nbsp;&nbsp;&nbsp;pylayers.measures.mesuwb Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.mesmimo">30&nbsp;&nbsp;&nbsp;pylayers.measures.mesmimo Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.cormoran">31&nbsp;&nbsp;&nbsp;pylayers.measures.cormoran Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.vna.E5072A">32&nbsp;&nbsp;&nbsp;pylayers.measures.vna.E5072A Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.parker.smparker">33&nbsp;&nbsp;&nbsp;pylayers.measures.parker.smparker Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.bsignal">34&nbsp;&nbsp;&nbsp;pylayers.signal.bsignal Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.standard">35&nbsp;&nbsp;&nbsp;pylayers.signal.standard Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.device">36&nbsp;&nbsp;&nbsp;pylayers.signal.device Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.DF">37&nbsp;&nbsp;&nbsp;pylayers.signal.DF Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.waveform">38&nbsp;&nbsp;&nbsp;pylayers.signal.waveform Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.mobility.agent">39&nbsp;&nbsp;&nbsp;pylayers.mobility.agent Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.mobility.ban.body">40&nbsp;&nbsp;&nbsp;pylayers.mobility.ban.body Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#id138">41&nbsp;&nbsp;&nbsp;pylayers.measures.cormoran Module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pylayers.simul.simulnet</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pylayers.simul.simulnet</h1><div class="highlight"><pre>
<span></span>#   -*- coding:Utf-8 -*-
from __future__ import print_function
&quot;&quot;&quot;
.. currentmodule:: pylayers.simul.simulnet

.. autosummary::

&quot;&quot;&quot;
import doctest
import os
import glob
#####################################################################
# authors :
# Nicolas AMIOT        : nicolas.amiot@univ-rennes1.fr
# Bernard UGUEN        : bernard.uguen@univ-rennes1.fr
#####################################################################

import pkgutil
import warnings
warnings.filterwarnings(&#39;ignore&#39;)
import numpy as np
import scipy as sp
import networkx as nx
import pandas as pd
import random
from random import seed

import time
import matplotlib.pyplot as plt
import sys
if sys.version_info.major==2:
    import ConfigParser
    from simpy.SimulationRT import SimulationRT, Process, hold
else:
    import configparser as ConfigParser
    import simpy

import pylayers.util.pyutil as pyu

from pylayers.network.network import Network, Node, PNetwork
from pylayers.network.communication import Gcom
from pylayers.network.show import ShowNet, ShowTable
from pylayers.mobility.agent import Agent
from pylayers.mobility.trajectory import *
from pylayers.network.emsolver import EMSolver
from pylayers.gis.layout import Layout
from pylayers.antprop.slab import Slab
from pylayers.util.utilnet import str2bool
from pylayers.mobility.transit.World import world
#from pylayers.util.pymysqldb import Database as DB
from pylayers.util.project import *
from pylayers.util.save import *


import pdb
import os


#~class Simul(SimulationRT):  # Simpy 2
<div class="viewcode-block" id="Simul"><a class="viewcode-back" href="../../../api/pylayers.simul.simulnet.Simul.html#pylayers.simul.simulnet.Simul">[docs]</a>class Simul(object):  # Simpy 3
    &quot;&quot;&quot;

    Attributes
    ----------

    config  : config parser instance
    sim_opt : dictionary of configuration option for simulation
    ag_opt : dictionary of configuration option for agent
    lay_opt : dictionary of  configuration option for layout
    meca_opt : dictionary of  configuration option for mecanic
    net_opt : dictionary of  configuration option for network
    loc_opt : dictionary of  configuration option for localization
    save_opt : dictionary of  configuration option for save
    sql_opt : dictionary of  configuration option for sql


    Parameters
    ----------

    self.lAg  : list of Agent(Object)
        list of agents involved in simulation
    self.L : Layout
        Layout used in simulation

    Note
    ----

    All the previous dictionnary are obtained from the chosen simulnet.ini file
    in the project directory

    &quot;&quot;&quot;

    def __init__(self):

        #SimulationRT.__init__(self)  # Simpy 2
        simpy.RealtimeEnvironment.__init__(self)  #simpy 3
        #self.initialize()

        self.config = ConfigParser.ConfigParser()
        filename = pyu.getlong(&#39;simulnet.ini&#39;, pstruc[&#39;DIRSIMUL&#39;])

        self.config.read(filename)
        self.sim_opt = dict(self.config.items(&#39;Simulation&#39;))
        self.lay_opt = dict(self.config.items(&#39;Layout&#39;))
        self.meca_opt = dict(self.config.items(&#39;Mechanics&#39;))
        self.net_opt = dict(self.config.items(&#39;Network&#39;))
        self.loc_opt = dict(self.config.items(&#39;Localization&#39;))
        self.save_opt = dict(self.config.items(&#39;Save&#39;))
        self.sql_opt = dict(self.config.items(&#39;Mysql&#39;))
        self.seed = eval(self.sim_opt[&#39;seed&#39;])

        self.traj = Trajectories()

        self.verbose = str2bool(self.sim_opt[&#39;verbose&#39;])
        if str2bool(self.net_opt[&#39;ipython_nb_show&#39;]):
            self.verbose = False
        self.roomlist = []

        self.finish = False
        self.create()

    def __repr__(self):

        s = &#39;Simulation information&#39; + &#39;\n----------------------&#39;
        s = s + &#39;\nLayout: &#39; + self.lay_opt[&#39;filename&#39;]
        s = s + &#39;\nSimulation duration: &#39; + str(self.sim_opt[&#39;duration&#39;])
        s = s + &#39;\nRandom seed: &#39; + str(self.sim_opt[&#39;seed&#39;])
        s = s + &#39;\nSave simulation: &#39; + self.save_opt[&#39;savep&#39;]

        s = s + &#39;\n\nUpdate times&#39; + &#39;\n-------------&#39;
        s = s + &#39;\nMechanical update: &#39; + \
            str(self.meca_opt[&#39;mecanic_update_time&#39;])
        s = s + &#39;\nNetwork update: &#39; + str(self.net_opt[&#39;network_update_time&#39;])
        s = s + &#39;\nLocalization update: &#39; + self.net_opt[&#39;communication_mode&#39;]

        s = s + &#39;\n\nAgents =&gt; self.lAg[i]&#39; + &#39;\n------&#39;
        s = s + &#39;\nNumber of agents :&#39; + str(len(self.lAg))
        s = s + &#39;\nAgents IDs: &#39; + \
            str([self.lAg[i].ID for i in range(len(self.lAg))])
        s = s + &#39;\nAgents names: &#39; + \
            str([self.lAg[i].name for i in range(len(self.lAg))])
        s = s + &#39;\nDestination of chosen agents: &#39; + \
            self.meca_opt[&#39;choose_destination&#39;]

        s = s + &#39;\n\nNetwork&#39; + &#39;\n-------&#39;
        s = s + &#39;\nNodes per wstd: &#39; + str(self.net.wstd)

        s = s + &#39;\n\nLocalization&#39; + &#39;\n------------&#39;
        s = s + &#39;\nLocalization enable: &#39; + self.loc_opt[&#39;localization&#39;]
        s = s + &#39;\nPostion estimation methods: &#39; + self.loc_opt[&#39;method&#39;]

        return s

<div class="viewcode-block" id="Simul.create_layout"><a class="viewcode-back" href="../../../api/pylayers.simul.simulnet.Simul.html#pylayers.simul.simulnet.Simul.create_layout">[docs]</a>    def create_layout(self):
        &quot;&quot;&quot; create Layout in Simpy the_world thanks to Tk backend

        &quot;&quot;&quot;

        _filename = self.lay_opt[&#39;filename&#39;]

        self.L = Layout(_filename)
        self.L.build()
        self.L.buildGr()
        self.L.buildGw()

        self.the_world = world()

        try:
            self.L.dumpr()
            print(&#39;Layout graphs are loaded from &#39; + basename + &#39;/struc/ini&#39;)
        except:
            #self.L.sl = sl
            # self.L.loadGr(G1)
            print(&#39;This is the first time the layout file is used\
            Layout graphs are curently being built, it may take few minutes.&#39;)
            self.L.build()
            self.L.dumpw()

        #
        # Create Layout
        #
        walls = self.L.thwall(0, 0)
        for wall in walls:
            for ii in range(0, len(wall) - 1):
                self.the_world.add_wall(wall[ii], wall[ii + 1])</div>

<div class="viewcode-block" id="Simul.create_agent"><a class="viewcode-back" href="../../../api/pylayers.simul.simulnet.Simul.html#pylayers.simul.simulnet.Simul.create_agent">[docs]</a>    def create_agent(self):
        &quot;&quot;&quot; create simulation&#39;s Agents

        ..todo:: change lAg list to a dictionnary ( modification in show.py too) 

        &quot;&quot;&quot;

        self.lAg = []
        agents = []
        Cf = ConfigParser.ConfigParser()
        Cf.read(pyu.getlong(&#39;agent.ini&#39;, &#39;ini&#39;))
        agents = eval(dict(Cf.items(&#39;used_agent&#39;))[&#39;list&#39;])
        for i, ag in enumerate(agents):
            ag_opt = dict(Cf.items(ag))
            self.lAg.append(
                    Agent(
                    ID=ag_opt[&#39;id&#39;],
                    name=ag_opt[&#39;name&#39;],
                    typ=ag_opt[&#39;typ&#39;],
                    color=eval(ag_opt[&#39;color&#39;]),
                    pdshow=str2bool(self.meca_opt[&#39;pdshow&#39;]),
                    pos=np.array(eval(ag_opt[&#39;pos&#39;])),
                    roomId=int(ag_opt[&#39;roomid&#39;]),
                    froom=eval(ag_opt[&#39;froom&#39;]),
                    meca_updt=float(self.meca_opt[&#39;mecanic_update_time&#39;]),
                    wait=float(ag_opt[&#39;wait&#39;]),
                    cdest=eval(self.meca_opt[&#39;choose_destination&#39;]),
                    loc=str2bool(self.loc_opt[&#39;localization&#39;]),
                    loc_updt=float(self.loc_opt[&#39;localization_update_time&#39;]),
                    loc_method=eval(self.loc_opt[&#39;method&#39;]),
                    L=self.L,
                    network=str2bool(self.net_opt[&#39;network&#39;]),
                    net=self.net,
                    epwr=dict([(eval((ag_opt[&#39;wstd&#39;]))[ep], 
                                eval((ag_opt[&#39;epwr&#39;]))[ep]) 
                                for ep in range(len(eval((ag_opt[&#39;wstd&#39;]))))]),
                    sens=dict([(eval((ag_opt[&#39;wstd&#39;]))[ep],
                                eval((ag_opt[&#39;sensitivity&#39;]))[ep]) 
                                for ep in range(len(eval((ag_opt[&#39;wstd&#39;]))))]),
                    world=self.the_world,
                    wstd=eval(ag_opt[&#39;wstd&#39;]),
                    save=eval(self.save_opt[&#39;save&#39;]),
                    gcom=self.gcom,
                    comm_mode=eval(self.net_opt[&#39;communication_mode&#39;]),
                    sim=self,
                    seed=self.seed))</div>

<div class="viewcode-block" id="Simul.create_EMS"><a class="viewcode-back" href="../../../api/pylayers.simul.simulnet.Simul.html#pylayers.simul.simulnet.Simul.create_EMS">[docs]</a>    def create_EMS(self):
        &quot;&quot;&quot; create electromagnetic Solver object

        &quot;&quot;&quot;
        self.EMS = EMSolver(L=self.L)</div>

<div class="viewcode-block" id="Simul.create_network"><a class="viewcode-back" href="../../../api/pylayers.simul.simulnet.Simul.html#pylayers.simul.simulnet.Simul.create_network">[docs]</a>    def create_network(self):
        &quot;&quot;&quot; create the whole network
        &quot;&quot;&quot;

        self.net = Network(EMS=self.EMS)
        self.gcom = Gcom(net=self.net, sim=self)

        self.create_agent()
        # create network
        if str2bool(self.net_opt[&#39;network&#39;]):
            self.net.create()

            # create All Personnal networks
            for n in self.net.nodes():
                self.net.node[n][&#39;PN&#39;]._get_wstd()
                self.net.node[n][&#39;PN&#39;]._get_SubNet()
            self.gcom.create()

           # create Process Network
            self.Pnet = PNetwork(net=self.net,
                                 net_updt_time=float(
                                     self.net_opt[&#39;network_update_time&#39;]),
                                 L=self.L,
                                 sim=self,
                                 show_sg=str2bool(self.net_opt[&#39;show_sg&#39;]),
                                 disp_inf=str2bool(self.net_opt[&#39;dispinfo&#39;]),
                                 save=eval(self.save_opt[&#39;save&#39;]))
            self.activate(self.Pnet, self.Pnet.run(), 0.0)</div>

<div class="viewcode-block" id="Simul.create_visual"><a class="viewcode-back" href="../../../api/pylayers.simul.simulnet.Simul.html#pylayers.simul.simulnet.Simul.create_visual">[docs]</a>    def create_visual(self):
        &quot;&quot;&quot; create visual Tk process
        &quot;&quot;&quot;

        self.visu = Updater(
            interval=float(self.sim_opt[&#39;show_interval&#39;]), sim=self)
        self.activate(self.visu, self.visu.execute(), 0.0)</div>

<div class="viewcode-block" id="Simul.create"><a class="viewcode-back" href="../../../api/pylayers.simul.simulnet.Simul.html#pylayers.simul.simulnet.Simul.create">[docs]</a>    def create(self):
        &quot;&quot;&quot; create the simulation
            This method is called at the end of __init__

        &quot;&quot;&quot;
        # this is to redump the database at each simulation
        if &#39;mysql&#39; in self.save_opt[&#39;save&#39;]:
            if str2bool(self.sql_opt[&#39;dumpdb&#39;]):
                os.popen(&#39;mysql -u &#39; + self.sql_opt[&#39;user&#39;] + &#39; -p &#39; + self.sql_opt[&#39;dbname&#39;] +
                         &#39;&lt; /private/staff/t/ot/niamiot/svn2/devel/simulator/pyray/SimWHERE2.sql&#39;)

        # TODO remove the hard reference
        if &#39;txt&#39; in self.save_opt[&#39;save&#39;]:
            pyu.writeDetails(self)
            if os.path.isfile(os.path.join(basename, &#39;output&#39;, &#39;Nodes.txt&#39;)):
                print(&#39;would you like to erase previous txt files ?&#39;)
                A = raw_input()
                if A == &#39;y&#39;:
                    for f in os.listdir(os.path.join(basename, &#39;output&#39;)):
                        try:
                            fi, ext = f.split(&#39;.&#39;)
                            if ext == &#39;txt&#39;:
                                os.remove(os.path.join(basename, &#39;output&#39; + f))
                        except:
                            pass

        # Layout
        self.create_layout()
        # Electro Magnetic Simulator
        self.create_EMS()
        # Network
        self.create_network()

        if str2bool(self.sim_opt[&#39;showtk&#39;]):
            self.create_visual()
        self.create_show()

        if str2bool(self.save_opt[&#39;savep&#39;]):
            self.save = Save(L=self.L, net=self.net, sim=self)
            self.activate(self.save, self.save.run(), 0.0)</div>

<div class="viewcode-block" id="Simul.create_show"><a class="viewcode-back" href="../../../api/pylayers.simul.simulnet.Simul.html#pylayers.simul.simulnet.Simul.create_show">[docs]</a>    def create_show(self):
        &quot;&quot;&quot; create a vizualization
        &quot;&quot;&quot;

        plt.ion()
        fig_net = &#39;network&#39;
        fig_table = &#39;table&#39;

        if str2bool(self.net_opt[&#39;show&#39;]):
            if str2bool(self.net_opt[&#39;ipython_nb_show&#39;]):
                notebook = True
            else:
                notebook = False
            self.sh = ShowNet(net=self.net, L=self.L, sim=self,
                              fname=fig_net, notebook=notebook)
            self.activate(self.sh, self.sh.run(), 1.0)

        if str2bool(self.net_opt[&#39;show_table&#39;]):
            self.sht = ShowTable(net=self.net, lAg=self.lAg,
                                 sim=self, fname=fig_table)
            self.activate(self.sht, self.sht.run(), 1.0)</div>

<div class="viewcode-block" id="Simul.savepandas"><a class="viewcode-back" href="../../../api/pylayers.simul.simulnet.Simul.html#pylayers.simul.simulnet.Simul.savepandas">[docs]</a>    def savepandas(self):
        &quot;&quot;&quot; save mechanics in pandas hdf5 format
        &quot;&quot;&quot;
        filename = pyu.getlong(
            eval(self.sim_opt[&quot;filename&quot;]), pstruc[&#39;DIRNETSAVE&#39;])
        layfile = self.L._filename.split(&#39;.&#39;)[0]
        store = pd.HDFStore(filename + &#39;_&#39; + layfile + &#39;.h5&#39;, &#39;w&#39;)
        for a in self.lAg:

            if a.typ != &#39;ap&#39;:
                store.put(a.ID, a.meca.df.convert_objects())

            else:  # if agent acces point, its position is saved
                store.put(a.ID, a.posdf)

            store.get_storer(a.ID).attrs.typ = a.typ
            store.get_storer(a.ID).attrs.name = a.name
            store.get_storer(a.ID).attrs.ID = a.ID
            store.get_storer(a.ID).attrs.layout = self.L._filename
        # saving metadata
        store.root._v_attrs.attributes=self.sim_opt
        store.close()
        self.traj.loadh5(
            eval(self.sim_opt[&quot;filename&quot;]) + &#39;_&#39; + layfile + &#39;.h5&#39;)</div>





<div class="viewcode-block" id="Simul.runsimul"><a class="viewcode-back" href="../../../api/pylayers.simul.simulnet.Simul.html#pylayers.simul.simulnet.Simul.runsimul">[docs]</a>    def runsimul(self):
        &quot;&quot;&quot; run simulation
        &quot;&quot;&quot;

        if not self.finish:
            # random number seed
            seed(self.seed)
            self.simulate(until=float(self.sim_opt[&#39;duration&#39;]),
                          real_time=True,
                          rel_speed=float(self.sim_opt[&#39;speedratio&#39;]))

            self.the_world._boids = {}

            # if str2bool(self.save_opt[&#39;savep&#39;]):
            # print &#39;Processing save results, please wait&#39;
            # self.save.mat_export()

            if str2bool(self.save_opt[&#39;savepd&#39;]):
                self.savepandas()
            self.finish = True
        else:
            raise NameError(&#39;Reinstantiate a new simul object to run again&#39;)</div></div>

if __name__ == &#39;__main__&#39;:

    S = Simul()
    S.runsimul()
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, PyLayers developer team.
      Last updated on Jan 28, 2019.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>