

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pylayers.antprop.coeffModel &mdash; PyLayers</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Python
          

          
            
            <img src="../../../_static/pylayers.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout1.html">Loading an outdoor layout from its address</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_antenna.html">Antenna Pattern for an H plane sectoral antenna &#64; 32GHz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout2.html">Building graphs of a Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_layout.html">8 Random Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_issue314.html">Exemple of issue 314</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_coverage.html">Indoor Radio Coverage with Motley Keenan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exAbsGas.html">Attenuation due to atmospheric gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exDLink.html">Evaluation of a radio link DLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_w1.html">Indoor Radio Coverage FP7 WHERE1 M1 setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLuebbers.html">UWB Ray tracing simulation  in outdoor scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_dakar.html">Outdoor Radio Coverage with Deygout Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_cover.html">Outdoor Radio Coverage with Deygout Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction_polar.html">Diffraction coefficient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction.html">Diffraction coefficient</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pylayers.antprop.coeffModel</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pylayers.antprop.coeffModel</h1><div class="highlight"><pre>
<span></span>&quot;&quot;&quot;
.. currentmodule:: pylayers.antprop.coeffModel

.. autosummary::
    :members:

&quot;&quot;&quot;
from __future__ import print_function
import doctest
import os
import glob
import doctest
import pdb
import numpy as np
import scipy as sp
import scipy.special as special
import matplotlib.pylab as plt
from numpy import zeros


<div class="viewcode-block" id="relative_error"><a class="viewcode-back" href="../../../api/pylayers.antprop.coeffModel.relative_error.html#pylayers.antprop.coeffModel.relative_error">[docs]</a>def relative_error(Eth_original, Eph_original,Eth_model, Eph_model,theta, phi, dsf=1,kf=-1):
    &quot;&quot;&quot; calculate relative error between original and model

    Parameters
    ----------

    Eth_original : np.array
    Eph_original : np.array
    Eth_model    : np.array
    Eph_model    : np.array
    theta : np.array
    phi : np.phi
    dsf : int
        down sampling factor
    kf : int

    &quot;&quot;&quot;

    st = np.sin(theta).reshape((len(theta), 1))
    #
    # Construct difference between reference and reconstructed
    #
    if kf!=-1:
        dTh = (Eth_model[kf, :, :] - Eth_original[kf, ::dsf, ::dsf])
        dPh = (Eph_model[kf, :, :] - Eph_original[kf, ::dsf, ::dsf])
        #
        # squaring  + Jacobian
        #
        dTh2 = np.real(dTh * np.conj(dTh)) * st
        dPh2 = np.real(dPh * np.conj(dPh)) * st

        vTh2 = np.real(Eth_original[kf, ::dsf, ::dsf] \
             * np.conj(Eth_original[kf, ::dsf, ::dsf])) * st
        vPh2 = np.real(Eph_original[kf, ::dsf, ::dsf] \
             * np.conj(Eph_original[kf, ::dsf, ::dsf])) * st

        mvTh2 = np.sum(vTh2)
        mvPh2 = np.sum(vPh2)

        errTh = np.sum(dTh2)
        errPh = np.sum(dPh2)
    else:
        dTh = (Eth_model[:, :, :] - Eth_original[:, ::dsf, ::dsf])
        dPh = (Eph_model[:, :, :] - Eph_original[:, ::dsf, ::dsf])
        #
        # squaring  + Jacobian
        #
        dTh2 = np.real(dTh * np.conj(dTh)) * st
        dPh2 = np.real(dPh * np.conj(dPh)) * st

        vTh2 = np.real(Eth_original[:, ::dsf, ::dsf] \
             * np.conj(Eth_original[:, ::dsf, ::dsf])) * st
        vPh2 = np.real(Eph_original[:, ::dsf, ::dsf] \
             * np.conj(Eph_original[:, ::dsf, ::dsf])) * st

        mvTh2 = np.sum(vTh2)
        mvPh2 = np.sum(vPh2)

        errTh = np.sum(dTh2)
        errPh = np.sum(dPh2)

    errelTh = (errTh / mvTh2)
    errelPh = (errPh / mvPh2)
    errel =( (errTh + errPh) / (mvTh2 + mvPh2))

    return(errelTh, errelPh, errel)</div>

<div class="viewcode-block" id="RepAzimuth1"><a class="viewcode-back" href="../../../api/pylayers.antprop.coeffModel.RepAzimuth1.html#pylayers.antprop.coeffModel.RepAzimuth1">[docs]</a>def RepAzimuth1 (Ec, theta, phi, th= np.pi/2,typ = &#39;Gain&#39;):
    &quot;&quot;&quot;  response in azimuth

    Parameters
    ----------
    Ec
    theta :
    phi :
    th :
    typ : string
        &#39;Gain&#39;
    &quot;&quot;&quot;

    pos_th = np.where(theta == th)[0][0]
    start = pos_th*len(phi)
    stop =  start + len(phi)
    if typ==&#39;Gain&#39;:
        V   =  np.sqrt(np.real(Ec[0,:,start:stop]*
                       np.conj(Ec[0,:,start:stop]) +
                       Ec[1,:,start:stop]*np.conj(Ec[1,:,start:stop]) +
                       Ec[2,:,start:stop]*np.conj(Ec[2,:,start:stop])))
    if typ==&#39;Ex&#39;:
        V = np.abs(Ec[0,:,start:stop])
    if typ==&#39;Ey&#39;:
        V = np.abs(Ec[1,:,start:stop])
    if typ==&#39;Ez&#39;:
        V = np.abs(Ec[2,:,start:stop])

    VdB = 20*np.log10(V)
    VdBmin = -40
    VdB = VdB - VdBmin
    V = VdB
    #plt.polar(phi,V)
    #plt.title(&#39;theta = &#39;+str(th)) 
    return V</div>

<div class="viewcode-block" id="mode_energy"><a class="viewcode-back" href="../../../api/pylayers.antprop.coeffModel.mode_energy.html#pylayers.antprop.coeffModel.mode_energy">[docs]</a>def mode_energy(C,M,L =20, ifreq = 46):
    &quot;&quot;&quot; calculates mode energy

    Parameters
    ----------

    C :
    M :
    L : int
    ifreq : int

    shape C = (dim = 3,Ncoef = (1+L)**2)
    &quot;&quot;&quot;
    Em = []
    Lc = (1+L)**2
    for m in range(M+1):
        im = m*(2*L+3-m)/2
        bind = (1+L)*(L+2)/2 + im-L-1
        if ifreq &gt; 0:
            if m == 0:
                em  = np.sum(np.abs(C[:,ifreq,im:im+L-m+1])**2)
            else:
                em  = np.sum(np.abs(C[:,ifreq,im:im+L-m+1])**2) + np.sum(np.abs(C[:,ifreq,bind:bind + L-m+1])**2)
            Et = np.sum(np.abs(C[:,ifreq,:])**2)

        Em.append(em)
    return  np.array(Em)/Et</div>

<div class="viewcode-block" id="mode_energy2"><a class="viewcode-back" href="../../../api/pylayers.antprop.coeffModel.mode_energy2.html#pylayers.antprop.coeffModel.mode_energy2">[docs]</a>def mode_energy2(A,m, ifreq=46, L= 20):
    &quot;&quot;&quot; calculates mode energy (version 2)

    Parameters
    ----------

    A :
    m :
    ifreq
    L  :

    &quot;&quot;&quot;

    cx = lmreshape(A.S.Cx.s2)
    cy = lmreshape(A.S.Cy.s2)
    cz = lmreshape(A.S.Cz.s2)

    if ifreq &gt;0:
        em = np.sum(np.abs(cx[ifreq,:,L+m])**2+np.abs(cy[ifreq,:,L+m])**2+np.abs(cz[ifreq,:,L+m])**2)
        Et = np.sum(np.abs(cx[ifreq])**2+np.abs(cy[ifreq])**2+np.abs(cz[ifreq])**2)
    return em/Et</div>

<div class="viewcode-block" id="level_energy"><a class="viewcode-back" href="../../../api/pylayers.antprop.coeffModel.level_energy.html#pylayers.antprop.coeffModel.level_energy">[docs]</a>def level_energy(A,l, ifreq = 46,L=20):
    &quot;&quot;&quot; calculates energy of the level l

    Parameters
    ----------

    A : Antenna
    l : int
        level
    ifreq
    L
    &quot;&quot;&quot;
    cx = lmreshape(A.S.Cx.s2)
    cy = lmreshape(A.S.Cy.s2)
    cz = lmreshape(A.S.Cz.s2)
    if ifreq &gt;0:
        el = np.sum(np.abs(cx[ifreq,l,:])**2+np.abs(cy[ifreq,l,:])**2+np.abs(cz[ifreq,l,:])**2)
        Et = np.sum(np.abs(cx[ifreq])**2+np.abs(cy[ifreq])**2+np.abs(cz[ifreq])**2)
    return el/Et</div>

<div class="viewcode-block" id="modeMax"><a class="viewcode-back" href="../../../api/pylayers.antprop.coeffModel.modeMax.html#pylayers.antprop.coeffModel.modeMax">[docs]</a>def modeMax(coeff,L= 20, ifreq  = 46):
    &quot;&quot;&quot; calculates maximal mode

    Parameters
    ----------


    coeff : 
    L  : int
        maximum level
    ifreq : int

    &quot;&quot;&quot;

    Em_dB = 20*np.log10(mode_energy(C = coeff,M = L))

    max_mode = np.where(Em_dB &lt;-20 )[0][0]-1
    return max_mode</div>

<div class="viewcode-block" id="lmreshape"><a class="viewcode-back" href="../../../api/pylayers.antprop.coeffModel.lmreshape.html#pylayers.antprop.coeffModel.lmreshape">[docs]</a>def lmreshape(coeff,L= 20):
    &quot;&quot;&quot; level and mode reshaping

    Parameters
    ----------

    coeff
    L : int
        maximum level
    &quot;&quot;&quot;

    sh = coeff.shape

    coeff_lm = zeros(shape = (sh[0],1+L, 1+2*L), dtype = complex )

    for m in range(0,1+L):
        im = m*(2*L+3-m)/2
        coeff_lm[:,m:L+1,L+m] = coeff[:,im:im +L+1-m]

    for m in range(1,L):
        im = m*(2*L+3-m)/2
        bind = (1+L)*(L+2)/2 + im-L-1
        coeff_lm[:,m:L+1,L-m]= coeff[:,bind: bind + L-m+1]

    return coeff_lm</div>

<div class="viewcode-block" id="sshModel"><a class="viewcode-back" href="../../../api/pylayers.antprop.coeffModel.sshModel.html#pylayers.antprop.coeffModel.sshModel">[docs]</a>def sshModel(c,d, L = 20):
    &quot;&quot;&quot; calculates sshModel

    Parameters
    ----------

    c : ssh coeff
        free space antenna coeff
    d : float
        distance (meters)
    L : int

    Returns
    -------

    cm : ssh coeff
        perturbed antenna coeff

    &quot;&quot;&quot;


    Lc = (1+L)**2
    sh = np.shape(c)
    cm = np.zeros(shape = sh , dtype = complex)
    m0 =  modeMax(c, L= 20, ifreq  = 46)
    im0 = m0*(2*L+3-m0)/2
    M = m0 + int(0.06*d) + 4
    a0 = 0.002*d+0.55
    am = -0.002*d + 1.55
    alpha = -0.006*d+1.22

    for m in range(0,m0):

        im = m*(2*L+3-m)/2
        if m == 0:
            dephm = 0
            cm[:,:,im: im+L+1-m] = a0*c[:,:,im: im+L+1-m]
        else:
            dephm = (m-m0)*alpha
            cm[:,:,im: im+L+1-m] = a0*c[:,:,im: im+L+1-m]*np.exp(1j*dephm)
            bind = (1+L)*(L+2)/2 + im-L-1
            cm[:,:,bind: bind + L-m+1] = ((-1)**m)*cm[:,:,im: im+L+1-m]


    for m in range(m0,M+1):

        dephm = (m-m0)*alpha
        if m == m0:

            im = m*(2*L+3-m)/2
            cm[:,:,im: im+L+1-m] = (am/(m-m0+1))*c[:,:,im0 : im0+L-m+1]*np.exp(1j*dephm)
            bind = (1+L)*(L+2)/2 + im -L-1
            cm[:,:,bind: bind + L-m+1] =  ((-1)**m)*(cm[:,:,im: im+L+1-m])

        else:

            im = m*(2*L+3-m)/2
            cm[:,:,im: im+L+1-m] = (am/(m-m0+1))*c[:,:,im0 : im0+L-m+1]*np.exp(1j*dephm)
            bind = (1+L)*(L+2)/2 + im -L-1
            cm[:,:,bind: bind + L-m+1] =  ((-1)**m)*(cm[:,:,im: im+L+1-m])

    cm[0:2] = c[0:2]
    return cm</div>

if (__name__==&quot;__main__&quot;):
    doctest.testmod()


</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, PyLayers developer team
      <span class="lastupdated">
        Last updated on Apr 05, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>